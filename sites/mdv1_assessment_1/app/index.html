<!--
* Author: Conor O'Mahony
* Assignment: Mobile and Device Development I - Assessment 1
* Student ID: STU-00001490 
* Date: 2018/04/04

* Refs: 
* Code Reuse - inspiration for using autodividers and making them collapsible 
    - https://jqmtricks.wordpress.com/2014/05/02/make-listview-dividers-collapsible/
* JSON data initially generated using mockaroo 
    - https://mockaroo.com
* Animal names and images 
    - https://www.randomlists.com/random-animals
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Page Title</title>

    <!-- ThemeRoller CSS -->
    <!-- <link rel="stylesheet" href="./css/themes/cons-custom-theme.css" /> -->
    <link rel="stylesheet" href="./css/themes/cons-custom-theme.min.css" />
    <link rel="stylesheet" href="./css/themes/jquery.mobile.icons.min.css" />

    <!-- Local JQuery CSS files -->
    <!-- jquery.mobile.structure css is for use with Themeroller custom theme -->
    <link rel="stylesheet" href="./css/jquery.mobile.structure-1.4.5.min.css">

    <!-- Custom CSS (generated from SASS) -->
    <link rel="stylesheet" href="./css/custom.css">

    <!-- Local JS files -->
    <script src="./js/jquery-1.11.1.min.js"></script>
    <script src="./js/jquery.mobile-1.4.5.min.js"></script>

</head>

<body>
    <!-- 
        Main Page 
    -->
    <div id="main-page" data-role="page" data-theme="b">
        <!-- header -->
        <div data-role="header">
            <h1>Adopt-An-Animal</h1>
        </div>
        <!-- /header -->
        <!-- content -->
        <div role="main" class="ui-content">
            <div class="cons-center">
                <img id="large-logo" src="./img/large_logo.png" alt="Adopt an Animal Logo" class="grit"/>
            </div>
            <div class="main-text cons-center ui-bar-b ui-bar">
                <p class="cons-center">
                    If you would like to help save the world, please consider adopting one of our animals below, they are all looking for a good
                    home, and we promise that they won't eat you.<sup>*</sup>
                </p>
                <p class="cons-center">
                    <small>* Warning- Animals may actually eat you.</small>
                </p>
            </div>
            <!-- <div class="ui-body ui-body-b"> -->
                <!-- list populated by script -->
                <ul id="main-list" data-role="listview" data-inset="true" data-filter="true" data-autodividers="true" data-divider-theme="a"
                    data-theme="a" data-filter-placeholder="Search"></ul>
            <!-- </div> -->
        </div>
        <!-- /content -->
        <!-- footer -->
        <div data-role="footer">
            <h4>Copyright &copy; 2018 Adopt-An-Animal</h4>
            <div class="cons-center">
                <a href='https://www.freepik.com/free-vector/collection-of-logos-with-animals_1719720.htm'><small>Logo vector created by Freepik</small></a>
            </div>
        </div>
        <!-- /footer -->
    </div>
    <!-- /page Main Page -->


    <!-- 
        Animal Page - This serves as a template for each animal page 
    -->
    <div data-role="page" id="animal-template" data-theme="b">
        <!-- header -->
        <div data-role="header">
            <h1>Adopt-An-Animal</h1>
        </div>
        <!-- /header -->
        <!-- content -->
        <div role="main" class="ui-content cons-center" class="grit">

            <!-- animal name -->
            <h2 class="ui-bar ui-bar-b ui-corner-all animal-name">Heading</h2>

            <!-- animal image -->
            <div class="ui-body-b">
                <img class="animal-image" src="" alt="">
            </div>
            
            <!-- animal information -->
            <div>
                <div class="ui-bar ui-bar-b">Country of Origin</div>
                <div class="animal-country ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Endangered Species?</div>
                <div class="animal-endangered ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Colour</div>
                <div class="animal-colour ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Diet</div>
                <div class="animal-diet ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Breeding Frequency</div>
                <div class="animal-frequency ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Catchphrase</div>
                <div class="animal-noise ui-body ui-body-b"></div>
                <div class="ui-bar ui-bar-b">Information</div>
                <div class="animal-info ui-body ui-body-b"></div>
            </div>
            <!-- Back Button -->
            <p>
                <a href="#main-page" data-transition="slide" data-direction="reverse" class="ui-btn ui-shadow ui-corner-all ui-btn-b ui-btn-icon-top ui-icon-back">Back to List</a>
            </p>
        </div>
        <!-- /content -->
        <!-- footer -->
        <div data-role="footer">
            <h4>Copyright &copy; 2018 Adopt-An-Animal</h4>
        </div>
        <!-- /footer -->
    </div>
    <!-- /page Animal Page -->

    <script>
        $(document).on("pagebeforecreate", function () {

            // Load JSON data from our data file 
            // use Promise Interface .done() method to process
            $.getJSON("./data/list-items.json").done(function (data) {
                var listItems = data.items;
                listItems.sort(sortByName);

                var listhtml = ""; // for creating our list
                $.each(listItems, function (i, item) {

                    // here we construct our html list markup in one string
                    // - create <li> for each animal object in the main list
                    var animalName = item.name + ' the ' + item.breed;
                    listhtml += '<li><a data-transition="slide" href="#animal' + item.id +
                        '"><img src="' + item.avatar + '" alt ="' + animalName + '"/>' + item.breed +
                        ' - ' + animalName + '</a></li>';

                    // different approach here
                    // clone our animal-template html page and customise for each animal
                    var $animalPage = $('#animal-template').clone();
                    $animalPage.attr('id', "animal" + item.id);
                    $animalPage.find('.animal-name').html(item.name + ' the ' + item.breed);
                    $animalPage.find('.animal-info').html(item.description);
                    $animalPage.find('.animal-image').attr('src', item.avatar).attr('alt', animalName);
                    $animalPage.find('.animal-country').html(item.country);
                    $animalPage.find('.animal-colour').html(item.colour);
                    $animalPage.find('.animal-diet').html(item.food);
                    $animalPage.find('.animal-frequency').html(item.frequency_1);
                    $animalPage.find('.animal-noise').html('"' + item.catchphrase + '"');
                    $animalPage.find('.animal-endangered').html((item.boolean_1 ? 'Yes' : 'No'));

                    // add our animal page
                    $('#main-page').after($animalPage);
                });

                $('#main-list').html(listhtml);
                // see https://api.jquerymobile.com/listview/#method-refresh 
                $('#main-list').listview('refresh');
                $('#main-list').enhanceWithin();

                // Code Reuse - see https://jqmtricks.wordpress.com/2014/05/02/make-listview-dividers-collapsible/
                // add a +/- icon to the autodivider (class .ul-li-divider)
                var ic = '<span class="ui-icon-minus ui-btn-icon-notext inlineIcon"></span>';
                $(".ui-li-divider").prepend(ic);
            });
        });

        // sort my list items
        function sortByName(a, b) {
            var aName = a.breed.toLowerCase();
            var bName = b.breed.toLowerCase();
            return ((aName < bName) ? -1 : ((aName > bName) ? 1 : 0));
        }

        //
        // Code Reuse: see https://jqmtricks.wordpress.com/2014/05/02/make-listview-dividers-collapsible/
        //
        $(document).on("click", '.ui-li-divider', function (e) {
            var IsCollapsed = false;
            var TheDivider = $(this);
            var li = TheDivider.next(':not(.ui-li-divider)');
            
            // collapse/expand all list items for clicked divider
            while (li.length > 0) {
                IsCollapsed = li.css('display') == 'none';
                li.slideToggle(300);
                li = li.next(':not(.ui-li-divider)');
            }

            // change the icon on the divider
            var $icon = TheDivider.find('.inlineIcon');
            if (!IsCollapsed) {
                $icon.removeClass('ui-icon-minus').addClass('ui-icon-plus');
            } else {
                $icon.removeClass('ui-icon-plus').addClass('ui-icon-minus');
            }
            e.stopPropagation();
            return false;
        });
    </script>
</body>

</html>