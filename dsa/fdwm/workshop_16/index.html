<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>


<body>
    <h1>Current Location</h1>

    <div id="myCurrentLocation">
    </div>
    <div id="myLocations">
    </div>
    <p>A demo of the Camera API, currently implemented in Firefox and Google Chrome on Android. Choose to take a picture with
        your device's camera and a preview will be shown through createObjectURL or a FileReader object (choosing local files
        supported too).</p>

    <p>
        <input type="file" id="take-picture" accept="image/*">
    </p>

    <h2>Preview:</h2>
    <p>
        <img src="about:blank" alt="" id="show-picture">
    </p>

    <p id="error"></p>

    <script type="text/javascript">
        var myLocations = document.getElementById("myLocations");
        var latlon = [];
        var pollCount = 0;

        setInterval(getLocation, 5000);

        (function () {
            var takePicture = document.querySelector("#take-picture"),
                showPicture = document.querySelector("#show-picture");

            if (takePicture && showPicture) {
                // Set events
                takePicture.onchange = function (event) {
                    // Get a reference to the taken picture or chosen file
                    var files = event.target.files,
                        file;
                    if (files && files.length > 0) {
                        file = files[0];
                        try {
                            // Create ObjectURL
                            var imgURL = window.URL.createObjectURL(file);

                            // Set img src to ObjectURL
                            showPicture.src = imgURL;

                            // Revoke ObjectURL
                            URL.revokeObjectURL(imgURL);
                            console.info("seems OK to here");
                        } catch (e) {
                            try {
                                // Fallback if createObjectURL is not supported
                                var fileReader = new FileReader();
                                fileReader.onload = function (event) {
                                    showPicture.src = event.target.result;
                                };
                                fileReader.readAsDataURL(file);
                            } catch (e) {
                                //
                                var error = document.querySelector("#error");
                                if (error) {
                                    error.innerHTML = "Neither createObjectURL or FileReader are supported";
                                }
                            }
                        }
                    }
                };
            }
        })();

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(savePosition);
            } else {
                console.warn("location not found");
            }
        }

        function savePosition(position) {
            var newPosition = position.coords.latitude + "," + position.coords.longitude;
            if (pollCount == 0 || latlon[pollCount - 1] != newPosition) {
                latlon[pollCount] = newPosition;
                pollCount += 1;
            }

            var text = "";
            for (i = 0; i < latlon.length; i++) {
                text += "<li>" + latlon[i] + "</li>";
            }
            myLocations.innerHTML = "<ul>" + text + "</ul>";

        }
    </script>

</body>

</html>