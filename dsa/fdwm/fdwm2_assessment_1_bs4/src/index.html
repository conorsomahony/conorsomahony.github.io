<!--
* Author: Conor O'Mahony
* Assignment: FDWM2 Assessment 1 - Street Art Finder
* Student ID: STU-00001490
* Date: 2018/02/26 

REFERENCES:
Development folder setup (including Bootstrap, SASS and CSS setup)
- https://www.youtube.com/watch?v=Mu74UmFBAq8&t=3s

Bootstrap 4 (with jQuery, Popper.js)
- https://coursetro.com/posts/code/130/Learn-Bootstrap-4-Final-in-2018-with-our-Free-Crash-Course
- https://getbootstrap.com/docs/4.0/getting-started/introduction/

Google Maps API
- https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse

jQuery
- https://www.youtube.com/playlist?list=PLillGF-RfqbYJVXBgZ_nA7FTAAEpp_IAc

localForage
- https://localforage.github.io/localForage/

Fonts
- https://fontawesome.com/
- https://fonts.google.com/specimen/Roboto
- https://www.graphicpear.com/humger-free-font/

-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Street Art Finder!</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.6/css/all.css">

    <!-- Bootstrap 4 imported into main.sass and compiled into main.css -->
    <!-- <link rel="stylesheet" href="./css/bootstrap.css"> -->
    <link rel="stylesheet" href="./css/main.css">

    <!-- Investigate localForage for IndexedDB/localStorage access -->
    <script src="./js/localforage.min.js"></script>
</head>

<body>
    <!-- header -->
    <header role="navigation">
        <!-- nav -->
        <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
            <div class="grow">
                <a class="navbar-brand" href="#">
                    <img src="./assets/img/streetart-logo_orig_trans.png" class="cons-nav-logo">
                </a>
            </div>
            <!-- toggle -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#account" aria-controls="navbarResponsive"
                aria-expanded="false" aria-label="Toggle navigation">
                <i class="fa fa-user fa-2x"></i>
            </button>

            <div class="collapse navbar-collapse" id="account">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item ml-auto">
                        <a class="nav-link" href="#">Sign in</a>
                    </li>
                    <li class="nav-item ml-auto">
                        <a class="nav-link" href="#">Register</a>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- end-of nav -->
    </header>
    <!-- end-of header -->

    <!-- main -->
    <main role="main">
        <!--"CAROUSEL" section -->
        <section>
            <div class="container-fluid">
                <div class="row no-gutters">
                    <div class="col-12">
                        <div id="myCarousel" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                                <li data-target="#myCarousel" data-slide-to="1"></li>
                                <li data-target="#myCarousel" data-slide-to="2"></li>
                            </ol>
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img id="carousel-item-1-img" class="d-block w-100 img-fluid" src="./assets/img/streetart_1.jpg" alt="First slide">
                                    <div class="carousel-caption cons-carousel-caption d-none d-md-block px-3">
                                        <div class="card-body">
                                            <h4 class="card-title">Cool Vista</h4>
                                            <p class="card-text">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Sapiente id magnam
                                                placeat nulla repellat harum nam quibusdam ut quisquam, facilis voluptate
                                                itaque veniam eaque voluptates, alias repellendus laudantium?.</p>
                                        </div>
                                        <div>
                                            <h5>
                                                <span class="badge badge-secondary">Location</span>
                                                <span class="badge badge-info">#Hashtag</span>
                                            </h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100 img-fluid" src="./assets/img/streetart_2.jpg" alt="Second slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100 img-fluid" src="./assets/img/streetart_3.jpg" alt="Third slide">
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end-of "CAROUSEL" section -->

        <!--"HOW TO" section -->
        <section>
            <!--"TOP LEVEL DARK" .container -->
            <div class="container text-light my-3 pb-2 bg-dark rounded cons-wall-background">
                <div class="row">
                    <div class="col text-center my-5">
                        <h1 class="cons-display-font">How to use StreetArt Finder</h1>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">1</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Take a photo</h3>
                        <p>Take a photo with your phone</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">2</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Upload it</h3>
                        <p>Upload it to StreetArt Finder</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">3</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Tag it</h3>
                        <p>Tag it so everyone can find it</p>
                    </div>
                </div>
            </div>
            <!-- end-of "TOP LEVEL DARK" .container -->
        </section>
        <!-- end-of "HOW TO" section -->

        <!-- "ALBUM" section-->
        <section>
            <!--"TOP LEVEL DARK" .container -->
            <div class="container-fluid text-light bg-dark">
                <div class="row">
                    <div class="col text-center my-5">
                        <h1 class="cons-display-font">Latest Uploads</h1>
                    </div>
                </div>
                <div class="container-fluid text-dark">
                    <div class="row">
                        <!-- .card -->
                        <div id="col-card-1" class="col-lg-6 mb-4">
                            <div class="card h-100">
                                <img class="card-img-top" src="./assets/img/streetart_1.jpg" alt="Card image cap">
                                <div class="card-body">
                                    <h4 class="card-title">Cool Vista</h4>
                                    <p class="card-text">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Sapiente id magnam placeat
                                        nulla repellat harum nam quibusdam ut quisquam, facilis voluptate itaque veniam eaque
                                        voluptates, alias repellendus laudantium?.</p>
                                </div>
                                <div class="card-footer">
                                    <h5>
                                        <span class="badge badge-secondary">Location</span>
                                        <span class="badge badge-info">#Hashtag</span>
                                    </h5>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div id="col-card-2" class="col-lg-6 mb-4">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" src="./assets/img/streetart_2.jpg" alt="Card image cap">
                                <div class="card-body">
                                    <h4 class="card-title">Political Satire</h4>
                                    <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Provident illo libero reprehenderit?
                                        Exercitationem blanditiis molestiae quod iste repellendus delectus dicta laudantium,
                                        impedit minus rem ab error ex rerum ratione animi?
                                    </p>
                                </div>
                                <div class="card-footer">
                                    <h5>
                                        <span class="badge badge-secondary">Location</span>
                                        <span class="badge badge-info">#Hashtag</span>
                                    </h5>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div id="col-card-3" class="col-lg-6 mb-4">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" src="./assets/img/streetart_3.jpg" alt="Card image cap">
                                <div class="card-body">
                                    <h4 class="card-title">Buenos Aires Bunny</h4>
                                    <p class="card-text">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Id necessitatibus sit tempora,
                                        esse ullam, provident magni placeat cum natus perferendis nam aperiam inventore eos
                                        neque et in amet harum sequi eligendi quo alias quis. Veniam?</p>
                                </div>
                                <div class="card-footer">
                                    <h5>
                                        <span class="badge badge-secondary">Location</span>
                                        <span class="badge badge-info">#Hashtag</span>
                                    </h5>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div id="col-card-4" class="col-lg-6 mb-4">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" id="card-4-img" src="./assets/img/streetart_4.jpg" alt="Card
                    image cap">
                                <div class="card-img-overlay">
                                    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#exampleModal" data-image-title="Madrid Master">Share&NonBreakingSpace;
                                        <i class="fa fa-share-alt" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h4 class="card-title" id="card-4-name">Madrid Master</h4>
                                    <p class="card-text" id="card-4-description">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Enim aspernatur, alias autem
                                        deleniti tenetur atque eveniet ut quo ipsum dolorum fuga aliquam voluptate blanditiis
                                        quis hic vel exercitationem sint corrupti a consectetur. Non, atque? Sapiente, iusto
                                        doloremque? Illo quisquam impedit laudantium corrupti molestias dignissimos atque!</p>
                                </div>
                                <div class="card-footer">
                                    <h5>
                                        <span class="badge badge-secondary">Location</span>
                                        <span class="badge badge-info" id="card-4-hashtag">#Hashtag</span>
                                    </h5>
                                </div>
                            </div>
                        </div>
                        <!-- end-of .card -->
                    </div>
                </div>
            </div>
            <!-- end-of "TOP LEVEL DARK" .container -->
        </section>
        <!-- end-of "ALBUM" section -->

        <!-- "UPLOAD" section -->
        <section>
            <!-- "TOP LEVEL LIGHT" .container -->
            <div class="container-fluid text-dark bg-light">
                <!--"UPLOAD" -->
                <div class="row">
                    <div class="col text-center">
                        <div class="my-4">
                            <h3>Upload</h3>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!--"UPLOAD INFO" -->
                    <div class="col-md-6 order-2 order-md-1">
                        <div class="card bg-info text-light mb-4">
                            <div class="card-body">
                                <h4 class="card-title">How to</h4>
                                <p class="card-text">
                                    Lorem ipsum dolor sit, amet consectetur adipisicing elit. Nostrum quis cupiditate ratione aperiam natus. Vitae deleniti excepturi,
                                    facilis nisi quis quasi? Sint minus vel, neque dolorum sit enim ea facere? Lorem, ipsum
                                    dolor sit amet consectetur adipisicing elit. Nobis, sit labore! Tenetur, laudantium ipsam
                                    deserunt officiis asperiores quis recusandae quos doloremque sit molestiae inventore
                                    illum soluta totam ipsum officia voluptatibus.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- end-of "UPLOAD INFO" -->

                    <!--"UPLOAD" form -->
                    <div class="col-md-6 order-1 order-md-2">
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="card-title d-none d-md-block h4 text-center">
                                    Upload here
                                </div>
                                <form id="uploadForm">
                                    <div class="form-group">
                                        <label for="photo-name">Photo Name</label>
                                        <input type="text" class="form-control" id="photo-name" placeholder="Photo Name" required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="photo-hashtag">Hashtag</label>
                                        <input type="text" class="form-control" id="photo-hashtag" placeholder="#" required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="photo-description">Description</label>
                                        <textarea class="form-control" id="photo-description" rows="3" placeholder="Description" required="true" maxlength="280"></textarea>
                                    </div>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="photo-file" accept="image/*" required="true">
                                        <label class="custom-file-label" for="customFile">Choose file</label>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary btn-lg text-light mt-3 w-100">Upload</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- end-of "UPLOAD" form -->
                </div>
            </div>
            <!-- end-of "TOP LEVEL LIGHT" -->
        </section>
        <!-- end-of "UPLOAD" section -->

    </main>
    <!-- end-of main -->


    <!-- footer -->
    <footer class="text-center text-light">
        <div>
            Copyright &copy; 2018 Street Art Finder
        </div>
    </footer>
    <!-- end-of footer -->

    <!--"MODAL SHARE DIALOG" -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel
                   " aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h4 class="modal-title" id="exampleModalLabel">Temporary text</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="text-light" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Temporary text2
                </div>
                <div class="modal-footer">
                    <div>
                        <a class="btn btn-primary" href="https://www.facebook.com" target="_blank">
                            <i class="fab fa-facebook fa-2x text-light"></i>
                        </a>
                        <a class="btn btn-primary" href="https://www.twitter.com" target="_blank">
                            <i class="fab fa-twitter fa-2x text-light"></i>
                        </a>
                        <a class="btn btn-primary" href="https://www.instagram.com" target="_blank">
                            <i class="fab fa-instagram fa-2x text-light"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end-of "MODAL SHARE DIALOG" -->

    <!--"MODAL UPLOAD COMPLETE" -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle
                   " aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h5 class="modal-title" id="exampleModalLongTitle">Upload complete!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="text-light" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Your image has been uploaded to StreetArt Finder!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./js/jquery.min.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script>
        // getLocation();
        setInterval(getLocation, 10000);

        var imagesStore = localforage.createInstance({
            name: "StreetArtImages"
        });

        var locationStore = localforage.createInstance({
            name: "StreetArtLocation"
        });

        //
        // JS: Get current location and store if different to last known location
        //
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    locationStore.getItem("lastLocation", function (err, lastLocation) {
                        console.log("lastLocation:" + lastLocation);
                        var location = position.coords.latitude + "," + position.coords.longitude;
                        console.log("location:" + location);
                        if (lastLocation != location) {
                            locationStore.setItem("lastLocation", location);
                            console.log("location:" + location);
                            doReverseLookup(location);
                        }
                    });
                });
            } else {
                console.warn("location not found");
            }
        }

        //
        // JS: Given a location, perform a geocoder reverse lookup to store name of location
        //
        function doReverseLookup(location) {
            var split = location.split(",");
            var latlng = {
                lat: parseFloat(split[0]),
                lng: parseFloat(split[1])
            };
            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({
                'location': latlng
            }, function (results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        // store formatted address
                        locationStore.setItem("locationText", results[0].formatted_address)
                        // store shorter address information
                        var res, locality, country = '';
                        var components = results[0].address_components;
                        for (var component = 0; component < (components.length); component++) {
                            if (components[component].types[0] == "locality") {
                                locality = components[component].long_name;
                            }
                            if (components[component].types[0] == "country") {
                                country = components[component].long_name;
                            }
                        }
                        res = locality + ', ' + country;
                        locationStore.setItem("shortLocationText", res);
                    } else {
                        console.warn('No results found');
                    }
                } else {
                    console.warn('Geocoder failed due to: ' + status);
                }
            });
        }

        //
        // jQuery: event handlers
        //
        $(document).ready(function () {

            // Handler for showing modal dialog for "Share" buttons
            //
            $('#exampleModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget) // Button that triggered the modal
                var imageTitle = button.data('image-title') // Extract info from data-* attributes
                // Update the modal's content.
                var modal = $(this)
                modal.find('.modal-title').text('Share" ' + imageTitle + '"')
                // get current location from local storage
                locationStore.getItem('shortLocationText').then(function (value) {
                    modal.find('.modal-body').text('Found this in ' + value +
                        ' with StreetArt Finder!')
                });
            });

            // Handler for upload form submit event
            //
            // prevent the form being submitted and handle it locally
            $('#uploadForm').on('submit', function (event) {
                event.preventDefault();
                var photoName = $('#photo-name').val();
                var photoDescription = $('#photo-description').val();
                var photoHashtag = $('#photo-hashtag').val();
                var photoFile = $('#photo-file')[0].files[0];
                var reader = new FileReader();
                reader.readAsDataURL(photoFile);
                reader.onload = function () {
                    var uploadedPhoto = {
                        name: photoName,
                        description: photoDescription,
                        hashtag: photoHashtag,
                        dataURL: reader.result
                    };
                    imagesStore.setItem(photoName, uploadedPhoto, function (err, result) {
                        putImageInCarousel(uploadedPhoto);
                        $('#exampleModalCenter').modal('show');
                    });
                }
            });
        });

        function putImageInCarousel(uploadedPhoto) {
            $('#carousel-item-1-img').attr('src', uploadedPhoto.dataURL);
            $('#card-4-img').attr('src', uploadedPhoto.dataURL);
            $('#card-4-name').text(uploadedPhoto.name);
            $('#card-4-description').text(uploadedPhoto.description);
            $('#card-4-hashtag').text(uploadedPhoto.hashtag);
            $('#col-card-4').addClass("order-1");
            $('#col-card-1').addClass("order-2");
            $('#col-card-2').addClass("order-3");
            $('#col-card-3').addClass("order-4");
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiBf9WrNYKOB-klGNa_HRZRfqu1hSh_Bw">
    </script>
</body>

</html>